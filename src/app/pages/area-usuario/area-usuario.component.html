<app-header></app-header>

<div class="pt-16">
  <section class="md:min-h-screen-minus-footer w-full bg-gray-50">
    <div class="imagem-fundo">
      <div class="mx-auto max-w-7xl px-4 md:px-6 lg:px-8 py-8">
        @if (usuario$ | async; as usuario) {
        <div class="flex items-center gap-4">
          @if (usuario.fotoPerfil) {
          <img [src]="usuario.fotoPerfil" alt="Foto do usuário"
            class="h-16 w-16 rounded-full ring-2 ring-white/50 object-cover" />
          } @else {
          <div
            class="h-16 w-16 rounded-full bg-white/20 text-white grid place-items-center text-lg font-glacial font-semibold ring-2 ring-white/40">
            {{ obterIniciais(usuario) }}
          </div>
          }

          <div class="min-w-0">
            <h1 class="text-white text-xl md:text-2xl font-bold truncate font-glacial">
              {{ nomeCompleto(usuario) || 'Usuário' }}
            </h1>
            <div class="mt-2 flex flex-wrap items-center gap-2">
              <span
                class="inline-flex items-center gap-2 rounded-full bg-white/20 text-white px-3 py-1 text-xs md:text-sm ring-1 ring-white/30">
                <i class="fa-regular fa-user"></i>
                Plano {{ usuario.plano?.nome || '-' }}
              </span>

              @if (usuario.plano?.vencimento) {
              <span
                class="inline-flex items-center gap-2 rounded-full bg-white/20 text-white px-3 py-1 text-xs md:text-sm ring-1 ring-white/30">
                <i class="fa-regular fa-calendar"></i>
                Renova em {{ formatarDataBR(usuario.plano?.vencimento) }}
              </span>
              }
            </div>
          </div>
        </div>
        } @else {
        <div class="flex items-center gap-4">
          <div class="h-16 w-16 rounded-full bg-white/20 animate-pulse"></div>
          <div class="h-6 w-48 bg-white/20 rounded animate-pulse"></div>
        </div>
        }
      </div>
    </div>

    <div class="mx-auto max-w-7xl px-4 md:px-6 lg:px-8">
      <nav class="w-full border-b border-gray-200">
        <ul class="flex flex-wrap justify-start gap-2 md:gap-3 py-3" role="tablist" aria-label="Navegação da conta">
          <li>
            <button type="button" class="tab-btn" [class.tab-btn--ativa]="estaAtiva('conta')"
              [class.tab-btn--disabled]="abasDesabilitadas.conta" [disabled]="abasDesabilitadas.conta" role="tab"
              aria-controls="painel-conta" [attr.aria-selected]="estaAtiva('conta')" (click)="setAba('conta')">
              <i class="fa-solid fa-user mr-2"></i>
              Minha Conta
            </button>
          </li>

          <li>
            <button type="button" class="tab-btn" [class.tab-btn--ativa]="estaAtiva('assinatura')"
              [class.tab-btn--disabled]="abasDesabilitadas.assinatura" [disabled]="abasDesabilitadas.assinatura"
              role="tab" aria-controls="painel-assinatura" [attr.aria-selected]="estaAtiva('assinatura')"
              (click)="setAba('assinatura')">
              <i class="fa-solid fa-signature mr-2"></i>
              Minha Assinatura
            </button>
          </li>

          <li>
            <button type="button" class="tab-btn" [class.tab-btn--ativa]="estaAtiva('carteira')"
              [class.tab-btn--disabled]="abasDesabilitadas.carteira" [disabled]="abasDesabilitadas.carteira" role="tab"
              aria-controls="painel-carteira" [attr.aria-selected]="estaAtiva('carteira')" (click)="setAba('carteira')">
              <i class="fa-solid fa-wallet mr-2"></i>
              Minha Carteira
            </button>
          </li>

          <li>
            <button type="button" class="tab-btn" [class.tab-btn--ativa]="estaAtiva('download')" role="tab"
              aria-controls="painel-download" [attr.aria-selected]="estaAtiva('download')" (click)="setAba('download')">
              <i class="fa-solid fa-download mr-2"></i>
              Download
            </button>
          </li>
        </ul>
      </nav>
    </div>

    <div class="mx-auto max-w-7xl px-4 md:px-6 lg:px-8 py-6 md:py-8">
      <div class="bg-white rounded-2xl ring-1 ring-gray-100 p-6 md:p-8">
        @switch (abaAtiva) {
        @case ('download') {
        <app-download-tab id="painel-download" role="tabpanel" />
        }
        @case ('conta') {
        <app-minha-conta-tab id="painel-conta" role="tabpanel" />
        }
        @case ('assinatura') {
        <app-minha-assinatura-tab id="painel-assinatura" role="tabpanel" />
        }
        @case ('carteira') {
        <app-minha-carteira-tab id="painel-carteira" role="tabpanel" />
        }
        }

        <div class="mt-6 pt-4 border-t border-gray-200 text-sm text-gray-700">
          @if (usuario$ | async; as usuario) {
          <div class="flex flex-wrap items-center gap-2">
            <span class="font-semibold font-glacial">Plano {{ usuario.plano?.nome || '-' }}</span>
            @if (usuario.plano?.vencimento) {
            <span class="text-gray-500">Renova em {{ formatarDataBR(usuario.plano?.vencimento) }}</span>
            }
          </div>
          }
        </div>
      </div>
    </div>
  </section>
  <app-footer></app-footer>
</div>